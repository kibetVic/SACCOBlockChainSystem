@model dynamic

@{
    ViewData["Title"] = "Blockchain Verification";
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h4><i class="fas fa-shield-alt"></i> Blockchain Verification</h4>
                </div>
                <div class="card-body text-center">
                    <div id="verificationResult">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Verifying transaction...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Extract transaction ID from URL
            var path = window.location.pathname;
            var transactionId = path.split('/').pop();

            // Call the API endpoint
            $.ajax({
                url: '/Blockchain/Verify/' + transactionId,
                type: 'GET',
                success: function(response) {
                    if (response.success) {
                        $('#verificationResult').html(`
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle fa-3x mb-3"></i>
                                <h4>Transaction Verified Successfully!</h4>
                                <hr>
                                <div class="text-start">
                                    <p><strong>Transaction ID:</strong> <code>${response.transaction.transactionId}</code></p>
                                    <p><strong>Type:</strong> <span class="badge bg-primary">${response.transaction.transactionType}</span></p>
                                    <p><strong>Member No:</strong> ${response.transaction.memberNo || 'N/A'}</p>
                                    <p><strong>Amount:</strong> KES ${response.transaction.amount.toLocaleString()}</p>
                                    <p><strong>Timestamp:</strong> ${new Date(response.transaction.timestamp).toLocaleString()}</p>
                                    <p><strong>Block Hash:</strong> <code>${response.transaction.blockHash || 'Pending'}</code></p>
                                    <p><strong>Status:</strong> <span class="badge ${response.transaction.status === 'CONFIRMED' ? 'bg-success' : 'bg-warning'}">${response.transaction.status}</span></p>
                                </div>
                            </div>
                            <a href="/" class="btn btn-primary mt-3">
                                <i class="fas fa-arrow-left"></i> Back to Dashboard
                            </a>
                        `);
                    } else {
                        $('#verificationResult').html(`
                            <div class="alert alert-danger">
                                <i class="fas fa-times-circle fa-3x mb-3"></i>
                                <h4>Verification Failed</h4>
                                <p>${response.message}</p>
                                <a href="/" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                                </a>
                            </div>
                        `);
                    }
                },
                error: function(xhr) {
                    $('#verificationResult').html(`
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                            <h4>Error Verifying Transaction</h4>
                            <p>Unable to connect to blockchain service. Please try again later.</p>
                            <a href="/" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Back to Dashboard
                            </a>
                        </div>
                    `);
                }
            });
        });
    </script>
}