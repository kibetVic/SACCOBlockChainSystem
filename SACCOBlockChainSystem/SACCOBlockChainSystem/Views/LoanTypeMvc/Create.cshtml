@model SACCOBlockChainSystem.Models.DTOs.LoanTypeCreateDTO

@{
    ViewData["Title"] = "Create Loan Type";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h1 class="h3 mb-0 text-gray-800">Create New Loan Type</h1>
            <p class="text-muted">Define a new loan product for members</p>
        </div>
        <div class="col-auto">
            <a asp-action="Index" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Loan Type Details</h6>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post">
                        @Html.AntiForgeryToken()

                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                        <div class="row">
                            <!-- Basic Information -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">Basic Information</h5>

                                <div class="form-group">
                                    <label asp-for="LoanCode" class="control-label">Loan Code *</label>
                                    <input asp-for="LoanCode" class="form-control" placeholder="e.g., LON001" />
                                    <span asp-validation-for="LoanCode" class="text-danger"></span>
                                    <small class="form-text text-muted">Unique code for this loan type</small>
                                </div>

                                <div class="form-group">
                                    <label asp-for="LoanType" class="control-label">Loan Type Name *</label>
                                    <input asp-for="LoanType" class="form-control" placeholder="e.g., Emergency Loan" />
                                    <span asp-validation-for="LoanType" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="LoanProduct" class="control-label">Loan Product</label>
                                    <input asp-for="LoanProduct" class="form-control" placeholder="e.g., Short-term Loan" />
                                    <span asp-validation-for="LoanProduct" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="ValueChain" class="control-label">Value Chain</label>
                                    <input asp-for="ValueChain" class="form-control" placeholder="e.g., Agriculture, Business" />
                                    <span asp-validation-for="ValueChain" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="Priority" class="control-label">Priority (1-10) *</label>
                                    <input asp-for="Priority" class="form-control" type="number" min="1" max="10" value="1" />
                                    <span asp-validation-for="Priority" class="text-danger"></span>
                                    <small class="form-text text-muted">Lower number = higher priority</small>
                                </div>
                            </div>

                            <!-- Financial Settings -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">Financial Settings</h5>

                                <div class="form-group">
                                    <label asp-for="LoanAcc" class="control-label">Loan Account *</label>
                                    <input asp-for="LoanAcc" class="form-control" placeholder="e.g., 110000" value="110000" />
                                    <span asp-validation-for="LoanAcc" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="InterestAcc" class="control-label">Interest Account</label>
                                    <input asp-for="InterestAcc" class="form-control" placeholder="e.g., 410000" />
                                    <span asp-validation-for="InterestAcc" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="PenaltyAcc" class="control-label">Penalty Account</label>
                                    <input asp-for="PenaltyAcc" class="form-control" placeholder="e.g., 420000" />
                                    <span asp-validation-for="PenaltyAcc" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="Ppacc" class="control-label">PP Account *</label>
                                    <input asp-for="Ppacc" class="form-control" placeholder="e.g., 200000" value="200000" />
                                    <span asp-validation-for="Ppacc" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="ContraAccount" class="control-label">Contra Account *</label>
                                    <input asp-for="ContraAccount" class="form-control" placeholder="e.g., 100000" value="100000" />
                                    <span asp-validation-for="ContraAccount" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4" />

                        <div class="row">
                            <!-- Loan Terms -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">Loan Terms</h5>

                                <div class="form-group">
                                    <label asp-for="MaxAmount" class="control-label">Maximum Loan Amount</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input asp-for="MaxAmount" class="form-control" type="number" step="0.01" />
                                    </div>
                                    <span asp-validation-for="MaxAmount" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="Interest" class="control-label">Interest Rate</label>
                                    <div class="input-group">
                                        <input asp-for="Interest" class="form-control" placeholder="e.g., 12% or 0.12" />
                                        <div class="input-group-append">
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                    <span asp-validation-for="Interest" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="RepayPeriod" class="control-label">Repayment Period (months)</label>
                                    <input asp-for="RepayPeriod" class="form-control" type="number" min="1" />
                                    <span asp-validation-for="RepayPeriod" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="GracePeriod" class="control-label">Grace Period (days)</label>
                                    <input asp-for="GracePeriod" class="form-control" type="number" min="0" value="0" />
                                    <span asp-validation-for="GracePeriod" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="ProcessingFee" class="control-label">Processing Fee</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input asp-for="ProcessingFee" class="form-control" type="number" step="0.01" />
                                    </div>
                                    <span asp-validation-for="ProcessingFee" class="text-danger"></span>
                                </div>
                            </div>

                            <!-- Features & Eligibility -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">Features & Eligibility</h5>

                                <div class="form-group">
                                    <label asp-for="EarningRatio" class="control-label">Earning Ratio</label>
                                    <input asp-for="EarningRatio" class="form-control" type="number" step="0.01" placeholder="e.g., 3.0" />
                                    <span asp-validation-for="EarningRatio" class="text-danger"></span>
                                    <small class="form-text text-muted">Loan amount = shares × ratio</small>
                                </div>

                                <div class="form-group">
                                    <label asp-for="MaxLoans" class="control-label">Maximum Loans per Member</label>
                                    <input asp-for="MaxLoans" class="form-control" type="number" min="1" />
                                    <span asp-validation-for="MaxLoans" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="RepayMethod" class="control-label">Repayment Method</label>
                                    <select asp-for="RepayMethod" class="form-control">
                                        <option value="">Select Method</option>
                                        <option value="MONTHLY">Monthly</option>
                                        <option value="WEEKLY">Weekly</option>
                                        <option value="BIWEEKLY">Bi-weekly</option>
                                        <option value="QUARTERLY">Quarterly</option>
                                        <option value="LUMP_SUM">Lump Sum</option>
                                    </select>
                                    <span asp-validation-for="RepayMethod" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="Guarantor" class="control-label">Require Guarantor</label>
                                    <select asp-for="Guarantor" class="form-control">
                                        <option value="">Optional</option>
                                        <option value="Y">Yes - Required</option>
                                        <option value="N">No - Not Required</option>
                                    </select>
                                    <span asp-validation-for="Guarantor" class="text-danger"></span>
                                </div>

                                <!-- Checkboxes -->
                                <div class="form-check mb-3">
                                    <input asp-for="UseIntRange" class="form-check-input" />
                                    <label asp-for="UseIntRange" class="form-check-label">Use Interest Range</label>
                                    <span asp-validation-for="UseIntRange" class="text-danger"></span>
                                </div>

                                <div class="form-check mb-3">
                                    <input asp-for="Penalty" class="form-check-input" />
                                    <label asp-for="Penalty" class="form-check-label">Apply Penalty for Late Payment</label>
                                    <span asp-validation-for="Penalty" class="text-danger"></span>
                                </div>

                                <div class="form-check mb-3">
                                    <input asp-for="Bridging" class="form-check-input" />
                                    <label asp-for="Bridging" class="form-check-label">Bridging Loan</label>
                                    <span asp-validation-for="Bridging" class="text-danger"></span>
                                </div>

                                <div class="form-check mb-3">
                                    <input asp-for="SelfGuarantee" class="form-check-input" />
                                    <label asp-for="SelfGuarantee" class="form-check-label">Allow Self Guarantee</label>
                                    <span asp-validation-for="SelfGuarantee" class="text-danger"></span>
                                </div>

                                <div class="form-check mb-3">
                                    <input asp-for="MobileLoan" class="form-check-input" />
                                    <label asp-for="MobileLoan" class="form-check-label">Available for Mobile Application</label>
                                    <span asp-validation-for="MobileLoan" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4" />

                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Create Loan Type
                            </button>
                            <a asp-action="Index" class="btn btn-secondary">Cancel</a>
                        </div>

                        <input type="hidden" asp-for="CompanyCode" />
                        <input type="hidden" asp-for="CreatedBy" />
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        // Auto-format interest rate input
        $('#Interest').on('blur', function() {
            let value = $(this).val();
            if (value && !value.includes('%')) {
                // Convert decimal to percentage
                let numValue = parseFloat(value);
                if (!isNaN(numValue)) {
                    if (numValue <= 1) {
                        $(this).val((numValue * 100) + '%');
                    } else {
                        $(this).val(numValue + '%');
                    }
                }
            }
        });
    </script>
}