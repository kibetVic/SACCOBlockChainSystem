@model SACCOBlockChainSystem.Models.DTOs.LoanTypeUpdateDTO

@{
    ViewData["Title"] = "Edit Loan Type";
    var loanCode = ViewBag.LoanCode as string;
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h1 class="h3 mb-0 text-gray-800">Edit Loan Type</h1>
            <p class="text-muted">Update loan type: <strong>@loanCode</strong></p>
        </div>
        <div class="col-auto">
            <a asp-action="Index" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
            <a asp-action="Details" asp-route-loanCode="@loanCode" class="btn btn-info ml-2">
                <i class="fas fa-eye"></i> View Details
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Edit Loan Type Details</h6>
                </div>
                <div class="card-body">
                    <form asp-action="Edit" asp-route-loanCode="@loanCode" method="post">
                        @Html.AntiForgeryToken()

                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> Editing a loan type that is already in use may affect existing loans.
                            Some critical fields cannot be changed if the loan type has active loans.
                        </div>

                        <div class="row">
                            <!-- Basic Information -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">Basic Information</h5>

                                <div class="form-group">
                                    <label class="control-label">Loan Code</label>
                                    <input type="text" class="form-control" value="@loanCode" readonly />
                                    <small class="form-text text-muted">Loan code cannot be changed</small>
                                </div>

                                <div class="form-group">
                                    <label asp-for="LoanType" class="control-label">Loan Type Name *</label>
                                    <input asp-for="LoanType" class="form-control" />
                                    <span asp-validation-for="LoanType" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="LoanProduct" class="control-label">Loan Product</label>
                                    <input asp-for="LoanProduct" class="form-control" />
                                    <span asp-validation-for="LoanProduct" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="ValueChain" class="control-label">Value Chain</label>
                                    <input asp-for="ValueChain" class="form-control" />
                                    <span asp-validation-for="ValueChain" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="Priority" class="control-label">Priority (1-10) *</label>
                                    <input asp-for="Priority" class="form-control" type="number" min="1" max="10" />
                                    <span asp-validation-for="Priority" class="text-danger"></span>
                                    <small class="form-text text-muted">Lower number = higher priority</small>
                                </div>
                            </div>

                            <!-- Financial Settings -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">Financial Settings</h5>

                                <div class="form-group">
                                    <label asp-for="LoanAcc" class="control-label">Loan Account *</label>
                                    <input asp-for="LoanAcc" class="form-control" />
                                    <span asp-validation-for="LoanAcc" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="InterestAcc" class="control-label">Interest Account</label>
                                    <input asp-for="InterestAcc" class="form-control" />
                                    <span asp-validation-for="InterestAcc" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="PenaltyAcc" class="control-label">Penalty Account</label>
                                    <input asp-for="PenaltyAcc" class="form-control" />
                                    <span asp-validation-for="PenaltyAcc" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="Ppacc" class="control-label">PP Account *</label>
                                    <input asp-for="Ppacc" class="form-control" />
                                    <span asp-validation-for="Ppacc" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="ContraAccount" class="control-label">Contra Account *</label>
                                    <input asp-for="ContraAccount" class="form-control" />
                                    <span asp-validation-for="ContraAccount" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4" />

                        <div class="row">
                            <!-- Loan Terms -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">Loan Terms</h5>

                                <div class="form-group">
                                    <label asp-for="MaxAmount" class="control-label">Maximum Loan Amount</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input asp-for="MaxAmount" class="form-control" type="number" step="0.01" />
                                    </div>
                                    <span asp-validation-for="MaxAmount" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="Interest" class="control-label">Interest Rate</label>
                                    <div class="input-group">
                                        <input asp-for="Interest" class="form-control" />
                                        <div class="input-group-append">
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                    <span asp-validation-for="Interest" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="RepayPeriod" class="control-label">Repayment Period (months)</label>
                                    <input asp-for="RepayPeriod" class="form-control" type="number" min="1" />
                                    <span asp-validation-for="RepayPeriod" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="GracePeriod" class="control-label">Grace Period (days)</label>
                                    <input asp-for="GracePeriod" class="form-control" type="number" min="0" />
                                    <span asp-validation-for="GracePeriod" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="ProcessingFee" class="control-label">Processing Fee</label>
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">$</span>
                                        </div>
                                        <input asp-for="ProcessingFee" class="form-control" type="number" step="0.01" />
                                    </div>
                                    <span asp-validation-for="ProcessingFee" class="text-danger"></span>
                                </div>
                            </div>

                            <!-- Features & Eligibility -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">Features & Eligibility</h5>

                                <div class="form-group">
                                    <label asp-for="EarningRatio" class="control-label">Earning Ratio</label>
                                    <input asp-for="EarningRatio" class="form-control" type="number" step="0.01" />
                                    <span asp-validation-for="EarningRatio" class="text-danger"></span>
                                    <small class="form-text text-muted">Loan amount = shares × ratio</small>
                                </div>

                                <div class="form-group">
                                    <label asp-for="MaxLoans" class="control-label">Maximum Loans per Member</label>
                                    <input asp-for="MaxLoans" class="form-control" type="number" min="1" />
                                    <span asp-validation-for="MaxLoans" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="RepayMethod" class="control-label">Repayment Method</label>
                                    <select asp-for="RepayMethod" class="form-control">
                                        <option value="">Select Method</option>
                                        <option value="MONTHLY">Monthly</option>
                                        <option value="WEEKLY">Weekly</option>
                                        <option value="BIWEEKLY">Bi-weekly</option>
                                        <option value="QUARTERLY">Quarterly</option>
                                        <option value="LUMP_SUM">Lump Sum</option>
                                    </select>
                                    <span asp-validation-for="RepayMethod" class="text-danger"></span>
                                </div>

                                <div class="form-group">
                                    <label asp-for="Guarantor" class="control-label">Require Guarantor</label>
                                    <select asp-for="Guarantor" class="form-control">
                                        <option value="">Optional</option>
                                        <option value="Y">Yes - Required</option>
                                        <option value="N">No - Not Required</option>
                                    </select>
                                    <span asp-validation-for="Guarantor" class="text-danger"></span>
                                </div>

                                <!-- Checkboxes -->
                                <div class="form-check mb-3">
                                    <input asp-for="UseIntRange" class="form-check-input" />
                                    <label asp-for="UseIntRange" class="form-check-label">Use Interest Range</label>
                                    <span asp-validation-for="UseIntRange" class="text-danger"></span>
                                </div>

                                <div class="form-check mb-3">
                                    <input asp-for="Penalty" class="form-check-input" />
                                    <label asp-for="Penalty" class="form-check-label">Apply Penalty for Late Payment</label>
                                    <span asp-validation-for="Penalty" class="text-danger"></span>
                                </div>

                                <div class="form-check mb-3">
                                    <input asp-for="Bridging" class="form-check-input" />
                                    <label asp-for="Bridging" class="form-check-label">Bridging Loan</label>
                                    <span asp-validation-for="Bridging" class="text-danger"></span>
                                </div>

                                <div class="form-check mb-3">
                                    <input asp-for="SelfGuarantee" class="form-check-input" />
                                    <label asp-for="SelfGuarantee" class="form-check-label">Allow Self Guarantee</label>
                                    <span asp-validation-for="SelfGuarantee" class="text-danger"></span>
                                </div>

                                <div class="form-check mb-3">
                                    <input asp-for="MobileLoan" class="form-check-input" />
                                    <label asp-for="MobileLoan" class="form-check-label">Available for Mobile Application</label>
                                    <span asp-validation-for="MobileLoan" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4" />

                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Update Loan Type
                            </button>
                            <a asp-action="Index" class="btn btn-secondary">Cancel</a>
                            <a asp-action="Delete" asp-route-loanCode="@loanCode" class="btn btn-danger float-right">
                                <i class="fas fa-trash"></i> Delete
                            </a>
                        </div>

                        <input type="hidden" asp-for="CompanyCode" />
                        <input type="hidden" asp-for="UpdatedBy" />
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}